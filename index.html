
</body>
</html>                }
            },
            
            // Utility Functions
            getCategoryName(category) {
                const names = {
                    vodka: 'Vodka',
                    gin: 'Gin',
                    rum: 'Rum',
                    whisky: 'Whisky',
                    tequila: 'Tequila',
                    liquori: 'Liquori',
                    champagne: 'Champagne/Spumanti',
                    analcolici: 'Analcolici',
                    energy: 'Energy Drink',
                    succhi: 'Succhi'
                };
                return names[category] || category;
            },
            
            getMovementTypeName(type) {
                const names = {
                    consumption: 'üìâ Consumo',
                    order: 'üì¶ Ordine',
                    adjustment: '‚úèÔ∏è Rettifica'
                };
                return names[type] || type;
            },
            
            getStockStatus(stock, product) {
                if (stock === 0) return '<span style="color: var(--danger);">‚ùå Esaurito</span>';
                if (stock < 5) return '<span style="color: var(--warning);">‚ö†Ô∏è Scorta bassa</span>';
                return '<span style="color: var(--success);">‚úÖ Disponibile</span>';
            },
            
            filterTable(tableId, searchTerm) {
                const rows = document.querySelectorAll(`#${tableId} tbody tr`);
                const term = searchTerm.toLowerCase();
                
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(term) ? '' : 'none';
                });
            },
            
            showAlert(message, type = 'info') {
                const alert = document.createElement('div');
                alert.className = `alert alert-${type}`;
                alert.innerHTML = `
                    ${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'} ${message}
                `;
                
                document.body.appendChild(alert);
                alert.style.position = 'fixed';
                alert.style.top = '20px';
                alert.style.right = '20px';
                alert.style.zIndex = '2000';
                alert.style.maxWidth = '400px';
                
                setTimeout(() => {
                    alert.style.opacity = '0';
                    setTimeout(() => alert.remove(), 300);
                }, 3000);
            },
            
            // Charts
            updateCharts() {
                this.updateCategoryChart();
                this.updateWeeklyTrendChart();
                this.updateStatistics();
            },
            
            updateCategoryChart() {
                const canvas = document.getElementById('categoryChart');
                const ctx = canvas.getContext('2d');
                
                // Calculate consumption by category
                const categoryData = {};
                
                this.movements.filter(m => m.type === 'consumption').forEach(m => {
                    const product = this.products.find(p => p.id === m.productId);
                    if (product) {
                        if (!categoryData[product.category]) {
                            categoryData[product.category] = 0;
                        }
                        categoryData[product.category] += Math.abs(m.quantity) * (product.price || 0);
                    }
                });
                
                // Simple bar chart
                const categories = Object.keys(categoryData);
                const values = Object.values(categoryData);
                const maxValue = Math.max(...values, 1);
                
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                const barWidth = canvas.width / (categories.length * 2);
                const barSpacing = barWidth;
                
                categories.forEach((category, index) => {
                    const x = index * (barWidth + barSpacing) + barSpacing;
                    const height = (values[index] / maxValue) * (canvas.height - 40);
                    const y = canvas.height - height - 20;
                    
                    // Draw bar
                    ctx.fillStyle = '#6366f1';
                    ctx.fillRect(x, y, barWidth, height);
                    
                    // Draw label
                    ctx.fillStyle = '#333';
                    ctx.font = '12px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(this.getCategoryName(category), x + barWidth/2, canvas.height - 5);
                    
                    // Draw value
                    ctx.fillText('‚Ç¨' + values[index].toFixed(0), x + barWidth/2, y - 5);
                });
            },
            
            updateWeeklyTrendChart() {
                const canvas = document.getElementById('weeklyTrendChart');
                const ctx = canvas.getContext('2d');
                
                // Get last 7 days
                const days = [];
                const values = [];
                
                for (let i = 6; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];
                    
                    const dayConsumption = this.movements
                        .filter(m => m.type === 'consumption' && m.date.startsWith(dateStr))
                        .reduce((sum, m) => {
                            const product = this.products.find(p => p.id === m.productId);
                            return sum + Math.abs(m.quantity) * (product?.price || 0);
                        }, 0);
                    
                    days.push(date.toLocaleDateString('it-IT', { weekday: 'short' }));
                    values.push(dayConsumption);
                }
                
                // Simple line chart
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                const maxValue = Math.max(...values, 1);
                const pointSpacing = canvas.width / (days.length - 1);
                
                // Draw grid lines
                ctx.strokeStyle = '#e5e7eb';
                ctx.lineWidth = 1;
                for (let i = 0; i <= 4; i++) {
                    const y = (canvas.height - 40) * (i / 4) + 20;
                    ctx.beginPath();
                    ctx.moveTo(0, y);
                    ctx.lineTo(canvas.width, y);
                    ctx.stroke();
                }
                
                // Draw line
                ctx.strokeStyle = '#6366f1';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                days.forEach((day, index) => {
                    const x = index * pointSpacing;
                    const y = canvas.height - 20 - (values[index] / maxValue) * (canvas.height - 40);
                    
                    if (index === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                    
                    // Draw point
                    ctx.fillStyle = '#6366f1';
                    ctx.beginPath();
                    ctx.arc(x, y, 4, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Draw label
                    ctx.fillStyle = '#333';
                    ctx.font = '12px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(day, x, canvas.height - 5);
                });
                
                ctx.stroke();
            },
            
            updateStatistics() {
                // Average night consumption
                const nightConsumptions = {};
                this.movements.filter(m => m.type === 'consumption').forEach(m => {
                    const date = m.date.split(' ')[0];
                    if (!nightConsumptions[date]) {
                        nightConsumptions[date] = 0;
                    }
                    const product = this.products.find(p => p.id === m.productId);
                    if (product && product.price) {
                        nightConsumptions[date] += Math.abs(m.quantity) * product.price;
                    }
                });
                
                const avgConsumption = Object.values(nightConsumptions).length > 0
                    ? Object.values(nightConsumptions).reduce((a, b) => a + b, 0) / Object.values(nightConsumptions).length
                    : 0;
                
                document.getElementById('avgNightConsumption').textContent = '‚Ç¨' + avgConsumption.toFixed(2);
                
                // Top category
                const categoryTotals = {};
                this.movements.filter(m => m.type === 'consumption').forEach(m => {
                    const product = this.products.find(p => p.id === m.productId);
                    if (product) {
                        if (!categoryTotals[product.category]) {
                            categoryTotals[product.category] = 0;
                        }
                        categoryTotals[product.category] += Math.abs(m.quantity) * (product.price || 0);
                    }
                });
                
                const topCategory = Object.entries(categoryTotals)
                    .sort((a, b) => b[1] - a[1])[0];
                
                document.getElementById('topCategory').textContent = topCategory 
                    ? this.getCategoryName(topCategory[0]) 
                    : '-';
                
                // Most profitable product
                const productProfits = {};
                this.movements.filter(m => m.type === 'consumption').forEach(m => {
                    const product = this.products.find(p => p.id === m.productId);
                    if (product && product.price) {
                        if (!productProfits[product.id]) {
                            productProfits[product.id] = 0;
                        }
                        productProfits[product.id] += Math.abs(m.quantity) * product.price;
                    }
                });
                
                const mostProfitable = Object.entries(productProfits)
                    .sort((a, b) => b[1] - a[1])[0];
                
                if (mostProfitable) {
                    const product = this.products.find(p => p.id === parseInt(mostProfitable[0]));
                    document.getElementById('mostProfitable').textContent = product ? product.name : '-';
                } else {
                    document.getElementById('mostProfitable').textContent = '-';
                }
                
                // Stock rotation (simplified)
                document.getElementById('stockRotation').textContent = '7 giorni';
            },
            
            // Report Generation
            generateReport() {
                const reportType = document.getElementById('reportType').value;
                const reportPeriod = document.getElementById('reportPeriod').value;
                const reportFormat = document.getElementById('reportFormat').value;
                
                this.showAlert(`Generazione report ${reportType} in formato                this.updateDashboard();
                this.closeModal('orderModal');
                this.showAlert('Ordine registrato con successo!', 'success');
            },
            
            saveNewProduct() {
                const name = document.getElementById('newProductName').value;
                const category = document.getElementById('newProductCategory').value;
                const format = parseFloat(document.getElementById('newProductFormat').value);
                const price = parseFloat(document.getElementById('newProductPrice').value);
                
                if (!name || !category || !format) {
                    this.showAlert('Compila tutti i campi obbligatori', 'error');
                    return;
                }
                
                const newProduct = {
                    id: Date.now(),
                    name: name.toUpperCase(),
                    category: category,
                    format: format,
                    price: price || null
                };
                
                this.products.push(newProduct);
                this.saveToStorage();
                this.updateProductsTable();
                this.closeModal('addProductModal');
                this.showAlert('Prodotto aggiunto con successo!', 'success');
            },
            
            // Order Item Management
            addOrderItem() {
                const container = document.getElementById('orderItems');
                const itemDiv = document.createElement('div');
                itemDiv.className = 'order-item form-grid';
                itemDiv.style.marginBottom = '15px';
                
                itemDiv.innerHTML = `
                    <div class="form-group" style="flex: 2;">
                        <label>Prodotto</label>
                        <select class="order-product">
                            <option value="">Seleziona prodotto</option>
                            ${this.products.map(p => 
                                `<option value="${p.id}">${p.name} (${p.format}L)</option>`
                            ).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Quantit√† (L)</label>
                        <input type="number" class="order-quantity" step="0.01" min="0" placeholder="0">
                    </div>
                    <div class="form-group" style="align-self: flex-end;">
                        <button class="btn btn-danger" onclick="this.parentElement.parentElement.remove()">
                            üóëÔ∏è Rimuovi
                        </button>
                    </div>
                `;
                
                container.appendChild(itemDiv);
            },
            
            // Inventory Adjustment
            adjustInventory(productId) {
                const product = this.products.find(p => p.id === productId);
                const currentStock = this.inventory[productId] || 0;
                
                const newStock = prompt(`Modifica giacenza per ${product.name}\nGiacenza attuale: ${currentStock.toFixed(2)}L\nNuova giacenza:`, currentStock);
                
                if (newStock !== null) {
                    const quantity = parseFloat(newStock);
                    if (!isNaN(quantity) && quantity >= 0) {
                        const difference = quantity - currentStock;
                        
                        if (difference !== 0) {
                            this.movements.push({
                                id: Date.now(),
                                date: new Date().toISOString(),
                                type: 'adjustment',
                                productId: productId,
                                quantity: difference,
                                note: 'Rettifica manuale inventario',
                                operator: 'Utente'
                            });
                        }
                        
                        this.inventory[productId] = quantity;
                        this.saveToStorage();
                        this.updateAllTables();
                        this.updateDashboard();
                        this.showAlert('Giacenza aggiornata con successo!', 'success');
                    }
                }
            },
            
            // Product Editing
            editProduct(productId) {
                const product = this.products.find(p => p.id === productId);
                
                const newPrice = prompt(`Modifica prezzo per ${product.name}\nPrezzo attuale: ‚Ç¨${product.price || 'N/D'}\nNuovo prezzo:`, product.price || '');
                
                if (newPrice !== null) {
                    const price = parseFloat(newPrice);
                    if (!isNaN(price) && price >= 0) {
                        product.price = price;
                        this.saveToStorage();
                        this.updateProductsTable();
                        this.updateDashboard();
                        this.showAlert('Prezzo aggiornato con successo!', 'success');
                                    this.showAlert(`Consumi della serata registrati! Totale: ‚Ç¨${totalConsumption.toFixed(2)}`, 'success');
            },
            
            saveOrder() {
                const supplier = document.getElementById('orderSupplier').value;
                const orderDate = document.getElementById('orderDate').value;
                
                if (!supplier || !orderDate) {
                    this.showAlert('Compila tutti i campi obbligatori', 'error');
                    return;
                }
                
                const orderItems = document.querySelectorAll('.order-item');
                const movements = [];
                
                orderItems.forEach(item => {
                    const productId = parseInt(item.querySelector('.order-product').value);
                    const quantity = parseFloat(item.querySelector('.order-quantity').value) || 0;
                    
                    if (productId && quantity > 0) {
                        movements.push({
                            id: Date.now() + Math.random(),
                            date: orderDate + ' 12:00:00',
                            type: 'order',
                            productId: productId,
                            quantity: quantity,
                            note: `Ordine da ${supplier}`,
                            operator: 'Sistema'
                        });
                        
                        // Update inventory
                        if (!this.inventory[productId]) {
                            this.inventory[productId] = 0;
                        }
                        this.inventory[productId] += quantity;
                    }
                });
                
                if (movements.length === 0) {
                    this.showAlert('Aggiungi almeno un prodotto all\'ordine', 'error');
                    return;
                }
                
                this.movements.push(...movements);
                this.saveToStorage();
                this.updateAllTables();                    { id: 81, name: "CRANBERRY", category: "succhi", format: 1, price: 1.99 },
                    { id: 82, name: "ANANAS", category: "succhi", format: 1, price: 3.58 },
                    { id: 83, name: "ARANCIA", category: "succhi", format: 1, price: 2.73 },
                    { id: 84, name: "SUCCO LIMONE FUSTO", category: "succhi", format: 1, price: 8.45 }
                ];
            },
            
            // Storage
            loadFromStorage() {
                const savedInventory = localStorage.getItem('cambusa_inventory');
                const savedMovements = localStorage.getItem('cambusa_movements');
                const savedProducts = localStorage.getItem('cambusa_products');
                
                if (savedInventory) this.inventory = JSON.parse(savedInventory);
                if (savedMovements) this.movements = JSON.parse(savedMovements);
                if (savedProducts) {
                    const customProducts = JSON.parse(savedProducts);
                    this.products = [...this.products, ...customProducts];
                }
            },
            
            saveToStorage() {
                localStorage.setItem('cambusa_inventory', JSON.stringify(this.inventory));
                localStorage.setItem('cambusa_movements', JSON.stringify(this.movements));
                
                // Save only custom products
                const customProducts = this.products.filter(p => p.id > 1000);
                localStorage.setItem('cambusa_products', JSON.stringify(customProducts));
            },
            
            // Event Listeners
            setupEventListeners() {
                // Tab navigation
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                        
                        e.target.classList.add('active');
                        const tabId = e.target.getAttribute('data-tab');
                        document.getElementById(tabId).classList.add('active');
                        
                        if (tabId === 'statistics') {
                            this.updateCharts();
                        }
                    });
                });
                
                // Search functionality
                document.getElementById('inventorySearch').addEventListener('input', (e) => {
                    this.filterTable('inventoryTable', e.target.value);
                });
                
                document.getElementById('productSearch').addEventListener('input', (e) => {
                    this.filterTable('productsTable', e.target.value);
                });
                
                // Movement filters
                document.getElementById('movementTypeFilter').addEventListener('change', () => this.updateMovementsTable());
                document.getElementById('movementStartDate').addEventListener('change', () => this.updateMovementsTable());
                document.getElementById('movementEndDate').addEventListener('change', () => this.updateMovementsTable());
            },
            
            // Table Updates
            updateAllTables() {
                this.updateInventoryTable();
                this.updateProductsTable();
                this.updateMovementsTable();
            },
            
            updateInventoryTable() {
                const tbody = document.querySelector('#inventoryTable tbody');
                tbody.innerHTML = '';
                
                this.products.forEach(product => {
                    const stock = this.inventory[product.id] || 0;
                    const value = stock * (product.price || 0);
                    const pricePerLiter = product.price ? (product.price / product.format).toFixed(2) : '-';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${product.name}</td>
                        <td><span class="badge badge-${product.category}">${this.getCategoryName(product.category)}</span></td>
                        <td>${product.format}L</td>
                        <td>‚Ç¨${pricePerLiter}</td>
                        <td>${stock.toFixed(2)}L</td>
                        <td>‚Ç¨${value.toFixed(2)}</td>
                        <td>${this.getStockStatus(stock, product)}</td>
                        <td>
                            <button class="btn btn-secondary" onclick="app.adjustInventory(${product.id})">
                                ‚úèÔ∏è Modifica
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            },
            
            updateProductsTable() {
                const tbody = document.querySelector('#productsTable tbody');
                tbody.innerHTML = '';
                
                this.products.forEach(product => {
                    const pricePerLiter = product.price ? (product.price / product.format).toFixed(2) : '-';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>#${product.id}</td>
                        <td>${product.name}</td>
                        <td><span class="badge badge-${product.category}">${this.getCategoryName(product.category)}</span></td>
                        <td>${product.format}L</td>
                        <td>${product.price ? '‚Ç¨' + product.price.toFixed(2) : '-'}</td>
                        <td>‚Ç¨${pricePerLiter}</td>
                        <td>
                            <button class="btn btn-secondary" onclick="app.editProduct(${product.id})">
                                ‚úèÔ∏è Modifica
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            },
            
            updateMovementsTable() {
                const tbody = document.querySelector('#movementsTable tbody');
                tbody.innerHTML = '';
                
                let filteredMovements = [...this.movements];
                
                // Apply filters
                const typeFilter = document.getElementById('movementTypeFilter').value;
                const startDate = document.getElementById('movementStartDate').value;
                const endDate = document.getElementById('movementEndDate').value;
                
                if (typeFilter) {
                    filteredMovements = filteredMovements.filter(m => m.type === typeFilter);
                }
                
                if (startDate) {
                    filteredMovements = filteredMovements.filter(m => m.date >= startDate);
                }
                
                if (endDate) {
                    filteredMovements = filteredMovements.filter(m => m.date <= endDate);
                }
                
                // Sort by date descending
                filteredMovements.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                filteredMovements.forEach(movement => {
                    const product = this.products.find(p => p.id === movement.productId);
                    const value = Math.abs(movement.quantity) * (product?.price || 0);
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${new Date(movement.date).toLocaleString('it-IT')}</td>
                        <td>${this.getMovementTypeName(movement.type)}</td>
                        <td>${product?.name || 'Prodotto rimosso'}</td>
                        <td>${movement.quantity > 0 ? '+' : ''}${movement.quantity.toFixed(2)}L</td>
                        <td>‚Ç¨${value.toFixed(2)}</td>
                        <td>${movement.note || '-'}</td>
                        <td>${movement.operator || 'Sistema'}</td>
                    `;
                    tbody.appendChild(row);
                });
                
                if (filteredMovements.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" class="empty-state"><p>Nessun movimento trovato</p></td></tr>';
                }
            },
            
            // Dashboard
            updateDashboard() {
                // Calculate total inventory value
                let totalValue = 0;
                let lowStockCount = 0;
                
                this.products.forEach(product => {
                    const stock = this.inventory[product.id] || 0;
                    if (product.price) {
                        totalValue += stock * product.price;
                    }
                    if (stock < 5 && stock > 0) {
                        lowStockCount++;
                    }
                });
                
                document.getElementById('totalValue').textContent = '‚Ç¨' + totalValue.toFixed(2);
                document.getElementById('lowStock').textContent = lowStockCount;
                
                // Calculate tonight's consumption (last consumption movement)
                const todayConsumptions = this.movements.filter(m => {
                    const today = new Date().toISOString().split('T')[0];
                    return m.type === 'consumption' && m.date.startsWith(today);
                });
                
                let nightConsumption = 0;
                todayConsumptions.forEach(m => {
                    const product = this.products.find(p => p.id === m.productId);
                    if (product && product.price) {
                        nightConsumption += Math.abs(m.quantity) * product.price;
                    }
                });
                
                document.getElementById('nightConsumption').textContent = '‚Ç¨' + nightConsumption.toFixed(2);
                
                // Update efficiency (example calculation)
                const efficiency = totalValue > 0 ? Math.min(95, (nightConsumption / totalValue) * 500) : 0;
                document.getElementById('efficiency').textContent = efficiency.toFixed(0) + '%';
                
                // Update top products table
                this.updateTopProducts();
            },
            
            updateTopProducts() {
                const tbody = document.querySelector('#topProductsTable tbody');
                tbody.innerHTML = '';
                
                // Calculate consumption by product
                const consumptionMap = {};
                const lastWeek = new Date();
                lastWeek.setDate(lastWeek.getDate() - 7);
                
                this.movements.filter(m => 
                    m.type === 'consumption' && 
                    new Date(m.date) >= lastWeek
                ).forEach(m => {
                    if (!consumptionMap[m.productId]) {
                        consumptionMap[m.productId] = 0;
                    }
                    consumptionMap[m.productId] += Math.abs(m.quantity);
                });
                
                // Sort by consumption
                const topProducts = Object.entries(consumptionMap)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);
                
                if (topProducts.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="empty-state"><p>Nessun dato disponibile. Inizia registrando i movimenti!</p></td></tr>';
                    return;
                }
                
                topProducts.forEach(([productId, consumption]) => {
                    const product = this.products.find(p => p.id === parseInt(productId));
                    if (!product) return;
                    
                    const value = consumption * (product.price || 0);
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${product.name}</td>
                        <td><span class="badge badge-${product.category}">${this.getCategoryName(product.category)}</span></td>
                        <td>${consumption.toFixed(2)}L</td>
                        <td>‚Ç¨${value.toFixed(2)}</td>
                        <td>üìà +15%</td>
                    `;
                    tbody.appendChild(row);
                });
            },
            
            // Modal Functions
            showInitialInventoryModal() {
                const form = document.getElementById('initialInventoryForm');
                form.innerHTML = '';
                
                // Group products by category
                const categories = {};
                this.products.forEach(product => {
                    if (!categories[product.category]) {
                        categories[product.category] = [];
                    }
                    categories[product.category].push(product);
                });
                
                Object.entries(categories).forEach(([category, products]) => {
                    const section = document.createElement('div');
                    section.className = 'card';
                    section.innerHTML = `<h3>${this.getCategoryName(category)}</h3>`;
                    
                    const grid = document.createElement('div');
                    grid.className = 'form-grid';
                    
                    products.forEach(product => {
                        const currentStock = this.inventory[product.id] || 0;
                        const group = document.createElement('div');
                        group.className = 'form-group';
                        group.innerHTML = `
                            <label>${product.name} (${product.format}L)</label>
                            <input type="number" 
                                   id="initial_${product.id}" 
                                   value="${currentStock}" 
                                   step="0.01" 
                                   min="0"
                                   placeholder="0">
                        `;
                        grid.appendChild(group);
                    });
                    
                    section.appendChild(grid);
                    form.appendChild(section);
                });
                
                document.getElementById('initialInventoryModal').classList.add('active');
            },
            
            showEndOfNightModal() {
                const form = document.getElementById('endOfNightForm');
                form.innerHTML = '';
                
                // Group products by category
                const categories = {};
                this.products.forEach(product => {
                    if (!categories[product.category]) {
                        categories[product.category] = [];
                    }
                    categories[product.category].push(product);
                });
                
                Object.entries(categories).forEach(([category, products]) => {
                    const section = document.createElement('div');
                    section.className = 'card';
                    section.innerHTML = `<h3>${this.getCategoryName(category)}</h3>`;
                    
                    const grid = document.createElement('div');
                    grid.className = 'form-grid';
                    
                    products.forEach(product => {
                        const currentStock = this.inventory[product.id] || 0;
                        const group = document.createElement('div');
                        group.className = 'form-group';
                        group.innerHTML = `
                            <label>${product.name} (${product.format}L)</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="number" 
                                       id="endnight_${product.id}" 
                                       value="${currentStock}" 
                                       step="0.01" 
                                       min="0"
                                       placeholder="0"
                                       style="flex: 1">
                                <span style="color: var(--gray);">Attuale: ${currentStock.toFixed(2)}L</span>
                            </div>
                        `;
                        grid.appendChild(group);
                    });
                    
                    section.appendChild(grid);
                    form.appendChild(section);
                });
                
                document.getElementById('endOfNightModal').classList.add('active');
            },
            
            showOrderModal() {
                document.getElementById('orderItems').innerHTML = '';
                this.addOrderItem();
                document.getElementById('orderModal').classList.add('active');
            },
            
            showAddProductModal() {
                document.getElementById('addProductModal').classList.add('active');
            },
            
            closeModal(modalId) {
                document.getElementById(modalId).classList.remove('active');
            },
            
            // Save Functions
            saveInitialInventory() {
                this.products.forEach(product => {
                    const input = document.getElementById(`initial_${product.id}`);
                    if (input) {
                        const quantity = parseFloat(input.value) || 0;
                        this.inventory[product.id] = quantity;
                    }
                });
                
                this.saveToStorage();
                this.updateAllTables();
                this.updateDashboard();
                this.closeModal('initialInventoryModal');
                this.showAlert('Giacenza iniziale salvata con successo!', 'success');
            },
            
            saveEndOfNight() {
                const nightDate = document.getElementById('nightDate').value;
                const consumptions = [];
                
                this.products.forEach(product => {
                    const input = document.getElementById(`endnight_${product.id}`);
                    if (input) {
                        const finalStock = parseFloat(input.value) || 0;
                        const initialStock = this.inventory[product.id] || 0;
                        const consumption = initialStock - finalStock;
                        
                        if (consumption !== 0) {
                            consumptions.push({
                                id: Date.now() + Math.random(),
                                date: nightDate + ' 23:59:59',
                                type: 'consumption',
                                productId: product.id,
                                quantity: -consumption,
                                note: 'Consumo serata',
                                operator: 'Sistema'
                            });
                            
                            // Update inventory
                            this.inventory[product.id] = finalStock;
                        }
                    }
                });
                
                // Add all consumptions to movements
                this.movements.push(...consumptions);
                
                this.saveToStorage();
                this.updateAllTables();
                this.updateDashboard();
                this.closeModal('endOfNightModal');
                
                // Calculate total consumption value
                let totalConsumption = 0;
                consumptions.forEach(c => {
                    const product = this.products.find(p => p.id === c.productId);
                    if (product && product.price) {
                        totalConsumption += Math.abs(c.quantity) * product.price;
                    }
                });
                
                this.show                    { id: 77, name: "COCACOLA LATTINA", category: "analcolici", format: 0.33, price: 0.80 },
                    { id: 78, name: "PEPSI FUSTO", category: "analcolici", format: 1, price: 60.39 },
                    { id: 79, name: "GINGER ALE", category: "analcolici", format: 1, price: 0.99 },
                    { id: 80, name: "GINGER BEER", category: "analcolici", format: 1, price: 0.99 },
                    
                    // Succhi
                    { id:                     <input type="number" id="newProductPrice" step="0.01" placeholder="0.00">
                </div>
            </div>
            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn btn-secondary" onclick="app.closeModal('addProductModal')">Annulla</button>
                <button class="btn btn-primary" onclick="app.saveNewProduct()">Salva Prodotto</button>
            </div>
        </div>
    </div>

    <script>
        // App principale
        const app = {
            // Dati
            products: [],
            inventory: {},
            movements: [],
            
            // Inizializzazione
            init() {
                this.loadInitialProducts();
                this.loadFromStorage();
                this.setupEventListeners();
                this.updateAllTables();
                this.updateDashboard();
                
                // Set today's date as default
                document.getElementById('nightDate').value = new Date().toISOString().split('T')[0];
                document.getElementById('orderDate').value = new Date().toISOString().split('T')[0];
            },
            
            // Carica prodotti iniziali
            loadInitialProducts() {
                this.products = [
                    // Vodka
                    { id: 1, name: "SKY VODKA BASE", category: "vodka", format: 1, price: 13.70 },
                    { id: 2, name: "RAJSSA VODKA FRAGOLA", category: "vodka", format: 1, price: 7.96 },
                    { id: 3, name: "RAJSSA VODKA MENTA", category: "vodka", format: 1, price: 7.96 },
                    { id: 4, name: "RAJSSA VODKA PESCA", category: "vodka", format: 1, price: 7.96 },
                    { id: 5, name: "VODKA PREMIUM", category: "vodka", format: 1, price: 44.99 },
                    { id: 6, name: "CIROC", category: "vodka", format: 0.7, price: null },
                    { id: 7, name: "SKYY", category: "vodka", format: 0.7, price: 11.40 },
                    { id: 8, name: "GREY GOOSE", category: "vodka", format: 0.7, price: 44.99 },
                    { id: 9, name: "BELVEDERE", category: "vodka", format: 0.7, price: 37.69 },
                    
                    // Gin
                    { id: 10, name: "BICKENS GIN BASE", category: "gin", format: 1, price: 14.70 },
                    { id: 11, name: "BICKENS PINK POMPELMO", category: "gin", format: 0.7, price: 14.50 },
                    { id: 12, name: "BOMBAY", category: "gin", format: 1, price: 24.05 },
                    { id: 13, name: "GIN MARE", category: "gin", format: 1, price: 45.00 },
                    { id: 14, name: "BULLDOG LONDON DRY", category: "gin", format: 1, price: 27.87 },
                    { id: 15, name: "GIN MARE", category: "gin", format: 0.7, price: 34.60 },
                    { id: 16, name: "BOMBAY", category: "gin", format: 0.7, price: 16.90 },
                    { id: 17, name: "HENDRICKS", category: "gin", format: 1, price: 27.50 },
                    { id: 18, name: "BULLDOG LONDON DRY", category: "gin", format: 0.7, price: 22.00 },
                    
                    // Rum
                    { id: 19, name: "KINGSTON RHUM BIANCO BASE", category: "rum", format: 1, price: 16.10 },
                    { id: 20, name: "CPT MORGAN", category: "rum", format: 1, price: 19.50 },
                    { id: 21, name: "BRUGAL", category: "rum", format: 1, price: 23.00 },
                    { id: 22, name: "HAVANA ESPECIAL", category: "rum", format: 1, price: 15.50 },
                    { id: 23, name: "HAVANA7", category: "rum", format: 0.7, price: 27.75 },
                    { id: 24, name: "BRUGAL", category: "rum", format: 0.7, price: 16.60 },
                    
                    // Whisky
                    { id: 25, name: "JACK DANIEL'S WHISKEY", category: "whisky", format: 1, price: 23.30 },
                    { id: 26, name: "JACK HONEY", category: "whisky", format: 0.7, price: 18.00 },
                    { id: 27, name: "JAMESON", category: "whisky", format: 1, price: 14.50 },
                    { id: 28, name: "JACK DANIEL'S WHISKEY", category: "whisky", format: 0.7, price: 19.70 },
                    { id: 29, name: "BLACK LABEL", category: "whisky", format: 1, price: 17.31 },
                    { id: 30, name: "GOLD LABEL", category: "whisky", format: 1, price: null },
                    
                    // Tequila
                    { id: 31, name: "TEQUILA BASE", category: "tequila", format: 1, price: 16.90 },
                    { id: 32, name: "PATRON SILVER", category: "tequila", format: 1, price: 42.50 },
                    { id: 33, name: "PATRON REPOSADO", category: "tequila", format: 1, price: 20.00 },
                    { id: 34, name: "TEQUILA ESPOLON", category: "tequila", format: 1, price: 20.50 },
                    { id: 35, name: "TEQUILA DON JULIO", category: "tequila", format: 1, price: 40.00 },
                    { id: 36, name: "PATRON REPOSADO", category: "tequila", format: 1, price: 37.00 },
                    
                    // Liquori
                    { id: 37, name: "BLU CURACAO", category: "liquori", format: 1, price: 14.10 },
                    { id: 38, name: "TRIPLE SEC", category: "liquori", format: 1, price: 7.50 },
                    { id: 39, name: "MALIBU", category: "liquori", format: 1, price: 17.50 },
                    { id: 40, name: "COCCORUM", category: "liquori", format: 1, price: 9.00 },
                    { id: 41, name: "MIDORI", category: "liquori", format: 0.7, price: 22.00 },
                    { id: 42, name: "MISAKI", category: "liquori", format: 1, price: 12.00 },
                    { id: 43, name: "4BIANCHI", category: "liquori", format: 1, price: 13.00 },
                    { id: 44, name: "APEROL BARBIERI", category: "liquori", format: 1, price: 13.50 },
                    { id: 45, name: "MARTINI ROSSO", category: "liquori", format: 1, price: 10.20 },
                    { id: 46, name: "CAMPARI BITTER", category: "liquori", format: 1, price: 16.80 },
                    { id: 47, name: "MONTENEGRO", category: "liquori", format: 0.7, price: 13.20 },
                    { id: 48, name: "DISARONNO", category: "liquori", format: 1, price: 19.03 },
                    { id: 49, name: "JAGERMEISTER", category: "liquori", format: 1.5, price: 27.90 },
                    { id: 50, name: "JAGER", category: "liquori", format: 1, price: 14.00 },
                    { id: 51, name: "HENNESSY aperto", category: "liquori", format: 1, price: 19.90 },
                    { id: 52, name: "JAGER", category: "liquori", format: 0.7, price: 12.00 },
                    { id: 53, name: "HENNESSY", category: "liquori", format: 1, price: 28.00 },
                    
                    // Champagne/Spumanti
                    { id: 54, name: "MOET IMPERIAL RESERVE", category: "champagne", format: 1, price: 40.00 },
                    { id: 55, name: "FERRARI PERLE", category: "champagne", format: 1, price: 40.10 },
                    { id: 56, name: "BELLA VISTA", category: "champagne", format: 1, price: 30.18 },
                    { id: 57, name: "DOM PERIGNON", category: "champagne", format: 1, price: 215.00 },
                    { id: 58, name: "LUC BELAIRE", category: "champagne", format: 1, price: null },
                    { id: 59, name: "LUC BELAIRE ROS√â", category: "champagne", format: 1, price: null },
                    { id: 60, name: "BOLLINGER", category: "champagne", format: 1, price: null },
                    { id: 61, name: "MOET NIR", category: "champagne", format: 1, price: null },
                    { id: 62, name: "MOET IMPERIAL", category: "champagne", format: 1, price: null },
                    { id: 63, name: "MOET ICE", category: "champagne", format: 1, price: null },
                    { id: 64, name: "FERRARI PERLE", category: "champagne", format: 1, price: 40.10 },
                    { id: 65, name: "BELLAVISTA", category: "champagne", format: 1, price: 30.18 },
                    
                    // Energy Drink
                    { id: 66, name: "REDBULL", category: "energy", format: 1, price: 1.20 },
                    { id: 67, name: "REDBULL ANGURIA", category: "energy", format: 1, price: 1.00 },
                    { id: 68, name: "REDBULL LEMON", category: "energy", format: 1, price: 1.00 },
                    { id: 69, name: "REDBULL TONICA", category: "energy", format: 1, price: 1.00 },
                    
                    // Analcolici
                    { id: 70, name: "TONICA PREMIUM", category: "analcolici", format: 1, price: 1.20 },
                    { id: 71, name: "TONICA", category: "analcolici", format: 1, price: 0.00 },
                    { id: 72, name: "TONICA FUSTO", category: "analcolici", format: 1, price: 62.15 },
                    { id: 73, name: "LEMON PREMIUM", category: "analcolici", format: 1, price: 1.20 },
                    { id: 74, name: "LEMON", category: "analcolici", format: 1, price: 0.00 },
                    { id: 75, name: "LEMON FUSTO", category: "analcolici", format: 1, price: 62.15 },
                    { id: 76, name: "COCA COLA", category: "analcolici", format: 1, price: 1.95 },
                    { id: 77, name: "COC                <h2>‚ûï Inserisci Giacenza Iniziale</h2>
                <button class="modal-close" onclick="app.closeModal('initialInventoryModal')">√ó</button>
            </div>
            <div class="alert alert-info">
                ‚ÑπÔ∏è Inserisci la giacenza iniziale per tutti i prodotti. Puoi aggiornare singoli prodotti in seguito.
            </div>
            <div id="initialInventoryForm"></div>
            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn btn-secondary" onclick="app.closeModal('initialInventoryModal')">Annulla</button>
                <button class="btn btn-primary" onclick="app.saveInitialInventory()">Salva Giacenza</button>
            </div>
        </div>
    </div>

    <div class="modal" id="endOfNightModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üåô Registra Fine Serata</h2>
                <button class="modal-close" onclick="app.closeModal('endOfNightModal')">√ó</button>
            </div>
            <div class="alert alert-info">
                ‚ÑπÔ∏è Inserisci la giacenza finale per calcolare i consumi della serata.
            </div>
            <div class="form-group">
                <label>Data Serata</label>
                <input type="date" id="nightDate" value="">
            </div>
            <div id="endOfNightForm"></div>
            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn btn-secondary" onclick="app.closeModal('endOfNightModal')">Annulla</button>
                <button class="btn btn-success" onclick="app.saveEndOfNight()">Calcola Consumi</button>
            </div>
        </div>
    </div>

    <div class="modal" id="orderModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ûï Nuovo Ordine</h2>
                <button class="modal-close" onclick="app.closeModal('orderModal')">√ó</button>
            </div>
            <div class="form-group">
                <label>Fornitore</label>
                <input type="text" id="orderSupplier" placeholder="Nome fornitore">
            </div>
            <div class="form-group">
                <label>Data Ordine</label>
                <input type="date" id="orderDate">
            </div>
            <div id="orderItemsContainer">
                <h3>Prodotti Ordinati</h3>
                <div id="orderItems"></div>
                <button class="btn btn-secondary" onclick="app.addOrderItem()">+ Aggiungi Prodotto</button>
            </div>
            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn btn-secondary" onclick="app.closeModal('orderModal')">Annulla</button>
                <button class="btn btn-primary" onclick="app.saveOrder()">Salva Ordine</button>
            </div>
        </div>
    </div>

    <div class="modal" id="addProductModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ûï Aggiungi Nuovo Prodotto</h2>
                <button class="modal-close" onclick="app.closeModal('addProductModal')">√ó</button>
            </div>
            <div class="form-grid">
                <div class="form-group">
                    <label>Nome Prodotto</label>
                    <input type="text" id="newProductName" placeholder="Es. Vodka Premium">
                </div>
                <div class="form-group">
                    <label>Categoria</label>
                    <select id="newProductCategory">
                        <option value="vodka">Vodka</option>
                        <option value="gin">Gin</option>
                        <option value="rum">Rum</option>
                        <option value="whisky">Whisky</option>
                        <option value="tequila">Tequila</option>
                        <option value="liquori">Liquori</option>
                        <option value="champagne">Champagne/Spumanti</option>
                        <option value="analcolici">Analcolici</option>
                        <option value="energy">Energy Drink</option>
                        <option value="succhi">Succhi</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Formato (L)</label>
                    <input type="number" id="newProductFormat" step="0.01" placeholder="1.0">
                </div>
                <div class="form-group">
                    <label>Prezzo (‚Ç¨)</label>
                    <input type="number" id="newProductPrice" step="        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--gray);
        }

        .form-group input,
        .form-group select {
            padding: 10px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-secondary {
            background: var(--gray);
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: var(--light);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            white-space: nowrap;
        }

        td {
            padding: 12px;
            border-top: 1px solid #e5e7eb;
        }

        tr:hover {
            background: #f9fafb;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .badge-vodka { background: #fee2e2; color: #dc2626; }
        .badge-gin { background: #dbeafe; color: #2563eb; }
        .badge-rum { background: #fef3c7; color: #d97706; }
        .badge-whisky { background: #fde68a; color: #92400e; }
        .badge-tequila { background: #d1fae5; color: #065f46; }
        .badge-liquori { background: #e9d5ff; color: #7c3aed; }
        .badge-champagne { background: #fce7f3; color: #be185d; }
        .badge-analcolici { background: #cffafe; color: #0891b2; }
        .badge-energy { background: #fecaca; color: #b91c1c; }
        .badge-succhi { background: #fed7aa; color: #c2410c; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border-left: 4px solid var(--primary);
        }

        .stat-card h3 {
            font-size: 0.875rem;
            color: var(--gray);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .stat-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark);
        }

        .stat-card .change {
            font-size: 0.875rem;
            margin-top: 5px;
        }

        .change.positive { color: var(--success); }
        .change.negative { color: var(--danger); }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--dark);
        }

        .alert {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
        }

        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 20px 12px 45px;
            border: 2px solid #e5e7eb;
            border-radius: 9999px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .search-box::before {
            content: "üîç";
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray);
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.75rem;
            }
            
            .nav-tabs {
                flex-wrap: nowrap;
                -webkit-overflow-scrolling: touch;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>üçæ Cambusa Tracker</h1>
            <p>Sistema completo di gestione magazzino per la tua discoteca</p>
        </div>
    </div>

    <div class="container">
        <div class="nav-tabs">
            <button class="nav-tab active" data-tab="dashboard">üìä Dashboard</button>
            <button class="nav-tab" data-tab="inventory">üì¶ Giacenza</button>
            <button class="nav-tab" data-tab="movements">üìù Movimenti</button>
            <button class="nav-tab" data-tab="products">üçæ Prodotti</button>
            <button class="nav-tab" data-tab="statistics">üìà Statistiche</button>
            <button class="nav-tab" data-tab="reports">üìÑ Report</button>
        </div>

        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Valore Totale Magazzino</h3>
                    <div class="value" id="totalValue">‚Ç¨0.00</div>
                    <div class="change positive">+0% vs ultima settimana</div>
                </div>
                <div class="stat-card">
                    <h3>Consumo Serata</h3>
                    <div class="value" id="nightConsumption">‚Ç¨0.00</div>
                    <div class="change negative">-0% vs media</div>
                </div>
                <div class="stat-card">
                    <h3>Prodotti in Esaurimento</h3>
                    <div class="value" id="lowStock">0</div>
                    <div class="change">Riordina subito</div>
                </div>
                <div class="stat-card">
                    <h3>Efficienza Magazzino</h3>
                    <div class="value" id="efficiency">0%</div>
                    <div class="change positive">Ottimo</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üî• Prodotti Pi√π Consumati (Ultima Settimana)</h2>
                </div>
                <div class="table-container">
                    <table id="topProductsTable">
                        <thead>
                            <tr>
                                <th>Prodotto</th>
                                <th>Categoria</th>
                                <th>Consumo (L)</th>
                                <th>Valore (‚Ç¨)</th>
                                <th>Trend</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="5" class="empty-state">
                                    <p>Nessun dato disponibile. Inizia registrando i movimenti!</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Inventory Tab -->
        <div class="tab-content" id="inventory">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üì¶ Gestione Giacenza</h2>
                    <div>
                        <button class="btn btn-secondary" onclick="app.showInitialInventoryModal()">
                            ‚ûï Giacenza Iniziale
                        </button>
                        <button class="btn btn-primary" onclick="app.showEndOfNightModal()">
                            üåô Fine Serata
                        </button>
                    </div>
                </div>

                <div class="search-box">
                    <input type="text" placeholder="Cerca prodotto..." id="inventorySearch">
                </div>

                <div class="table-container">
                    <table id="inventoryTable">
                        <thead>
                            <tr>
                                <th>Prodotto</th>
                                <th>Categoria</th>
                                <th>Formato</th>
                                <th>Prezzo/L</th>
                                <th>Giacenza (L)</th>
                                <th>Valore (‚Ç¨)</th>
                                <th>Stato</th>
                                <th>Azioni</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Movements Tab -->
        <div class="tab-content" id="movements">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìù Registro Movimenti</h2>
                    <button class="btn btn-primary" onclick="app.showOrderModal()">
                        ‚ûï Nuovo Ordine
                    </button>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Filtra per tipo</label>
                        <select id="movementTypeFilter">
                            <option value="">Tutti</option>
                            <option value="consumption">Consumo</option>
                            <option value="order">Ordine</option>
                            <option value="adjustment">Rettifica</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Data inizio</label>
                        <input type="date" id="movementStartDate">
                    </div>
                    <div class="form-group">
                        <label>Data fine</label>
                        <input type="date" id="movementEndDate">
                    </div>
                </div>

                <div class="table-container">
                    <table id="movementsTable">
                        <thead>
                            <tr>
                                <th>Data/Ora</th>
                                <th>Tipo</th>
                                <th>Prodotto</th>
                                <th>Quantit√† (L)</th>
                                <th>Valore (‚Ç¨)</th>
                                <th>Note</th>
                                <th>Operatore</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Products Tab -->
        <div class="tab-content" id="products">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üçæ Catalogo Prodotti</h2>
                    <button class="btn btn-primary" onclick="app.showAddProductModal()">
                        ‚ûï Aggiungi Prodotto
                    </button>
                </div>

                <div class="search-box">
                    <input type="text" placeholder="Cerca prodotto..." id="productSearch">
                </div>

                <div class="table-container">
                    <table id="productsTable">
                        <thead>
                            <tr>
                                <th>Codice</th>
                                <th>Nome</th>
                                <th>Categoria</th>
                                <th>Formato</th>
                                <th>Prezzo (‚Ç¨)</th>
                                <th>Prezzo/L (‚Ç¨)</th>
                                <th>Azioni</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Statistics Tab -->
        <div class="tab-content" id="statistics">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Consumo Medio Serata</h3>
                    <div class="value" id="avgNightConsumption">‚Ç¨0.00</div>
                </div>
                <div class="stat-card">
                    <h3>Categoria Pi√π Venduta</h3>
                    <div class="value" id="topCategory">-</div>
                </div>
                <div class="stat-card">
                    <h3>Prodotto Pi√π Redditizio</h3>
                    <div class="value" id="mostProfitable">-</div>
                </div>
                <div class="stat-card">
                    <h3>Rotazione Media Stock</h3>
                    <div class="value" id="stockRotation">0 giorni</div>
                </div>
            </div>

            <div class="card">
                <h2 class="card-title">üìä Analisi Consumi per Categoria</h2>
                <canvas id="categoryChart" width="400" height="200"></canvas>
            </div>

            <div class="card">
                <h2 class="card-title">üìà Trend Consumi Settimanali</h2>
                <canvas id="weeklyTrendChart" width="400" height="200"></canvas>
            </div>
        </div>

        <!-- Reports Tab -->
        <div class="tab-content" id="reports">
            <div class="card">
                <h2 class="card-title">üìÑ Genera Report</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Tipo Report</label>
                        <select id="reportType">
                            <option value="inventory">Report Inventario</option>
                            <option value="consumption">Report Consumi</option>
                            <option value="orders">Report Ordini</option>
                            <option value="financial">Report Finanziario</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Periodo</label>
                        <select id="reportPeriod">
                            <option value="day">Giornaliero</option>
                            <option value="week">Settimanale</option>
                            <option value="month">Mensile</option>
                            <option value="custom">Personalizzato</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Formato</label>
                        <select id="reportFormat">
                            <option value="pdf">PDF</option>
                            <option value="excel">Excel</option>
                            <option value="csv">CSV</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="app.generateReport()">
                    üì• Genera Report
                </button>
            </div>

            <div class="card">
                <h2 class="card-title">üìÖ Report Recenti</h2>
                <div class="table-container">
                    <table id="reportsTable">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Tipo</th>
                                <th>Periodo</th>
                                <th>Formato</th>
                                <th>Azioni</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="5" class="empty-state">
                                    <p>Nessun report generato</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="initialInventoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cambusa Tracker - Gestione Magazzino Discoteca</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #111827;
            --gray: #6b7280;
            --light: #f3f4f6;
            --white: #ffffff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--light);
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 30px 0;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e5e7eb;
            overflow-x: auto;
            padding-bottom: 2px;
        }

        .nav-tab {
            padding: 12px 24px;
            background: white;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            color: var(--gray);
            border-radius: 8px 8px 0 0;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .nav-tab:hover {
            background: var(--light);
        }

        .nav-tab.active {
            color: var(--primary);
            background: white;
            border-bottom: 2px solid var(--primary);
            margin-bottom: -2px;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--dark);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
